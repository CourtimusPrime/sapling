// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  engineType = "client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Conversation {
  id        String   @id @default(uuid()) @db.Uuid
  title     String?
  createdAt DateTime @default(now()) @db.Timestamptz()

  messages Message[]

  @@map("conversations")
}

enum MessageRole {
  system
  user
  assistant
}

model Message {
  id               String       @id @default(uuid()) @db.Uuid
  conversationId   String       @db.Uuid
  conversation     Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  parentMessageId  String?      @db.Uuid
  parentMessage    Message?     @relation("MessageHierarchy", fields: [parentMessageId], references: [id])
  children         Message[]    @relation("MessageHierarchy")
  role             MessageRole
  content          String
  depth            Int
  createdAt        DateTime     @default(now()) @db.Timestamptz()

  @@index([parentMessageId], name: "idx_messages_parent")
  @@index([conversationId], name: "idx_messages_conversation")
  @@index([depth], name: "idx_messages_depth")
  @@index([conversationId, createdAt], name: "idx_messages_conversation_created_at")
  @@map("messages")
}